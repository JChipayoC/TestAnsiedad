<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test de Autoayuda</title>
    <link rel="stylesheet" href="test.css">
    <script>
        let currentQuestionIndex = 0;
        let answers = [];
        let questions = []; // Almacenar preguntas aquÃ­

        // --- LÃ“GICA DE LA APLICACIÃ“N ---

        // FunciÃ³n para obtener el nombre de la URL
        function obtenerNombre() {
            const urlParams = new URLSearchParams(window.location.search);
            const nombre = urlParams.get('nombre') || "Usuario"; // Nombre por defecto
            document.getElementById("nombreUsuario").innerText = "Hola, " + nombre + ". Â¡Vamos a comenzar!";
            sessionStorage.setItem('nombreUsuario', nombre);
        }

        // FunciÃ³n para cargar preguntas desde el archivo JSON
        async function cargarPreguntas() {
            try {
                const res = await fetch('quest.json');
                questions = await res.json();
            } catch (error) {
                console.error("No se pudieron cargar las preguntas:", error);
                document.getElementById('question-text').innerText = "Error: No se pudieron cargar las preguntas. Revisa que el archivo 'quest.json' exista.";
            }
        }

        function cerrarModal() {
            document.getElementById('instruction-modal').style.display = 'none';
        }


        // Muestra la pregunta actual y actualiza la animaciÃ³n
        function showQuestion(questionText) {
            const questionContainer = document.getElementById('question-container');
            const questionTextElement = document.getElementById('question-text');

            questionContainer.classList.remove('fade-in'); // Prepara para la animaciÃ³n

            setTimeout(() => {
                questionTextElement.innerText = questionText;
                questionContainer.classList.add('fade-in'); // AnimaciÃ³n de entrada
            }, 150); // PequeÃ±a espera para que la animaciÃ³n sea fluida
        }

        // Guarda la respuesta seleccionada
        function saveAnswer() {
            const selected = document.querySelector('input[name="answer"]:checked');
            if (!selected) {
                alert('Por favor selecciona una respuesta para continuar.');
                return false;
            }
            answers[currentQuestionIndex] = parseInt(selected.value);
            return true;
        }

        // âœ¨ FunciÃ³n para actualizar la barra de progreso
        function updateProgress() {
            const progressText = document.getElementById('progress-text');
            const progressFlowers = document.getElementById('progress-flowers');
            const totalQuestions = questions.length;

            if (totalQuestions > 0) {
                progressText.innerText = `Pregunta ${currentQuestionIndex + 1} de ${totalQuestions}`;

                let flowersHtml = '';
                for (let i = 0; i < totalQuestions; i++) {
                    flowersHtml += (i <= currentQuestionIndex) ? 'ğŸŒ¸' : 'âšª';
                }
                progressFlowers.innerHTML = flowersHtml;
            }
        }

        // Avanza a la siguiente pregunta o finaliza el test
        async function nextQuestion() {
            if (!saveAnswer()) return;

            // Desmarcar la selecciÃ³n actual
            document.querySelector('input[name="answer"]:checked').checked = false;

            currentQuestionIndex++;

            if (currentQuestionIndex >= questions.length) {
                const totalScore = answers.reduce((a, b) => a + b, 0);
                sessionStorage.setItem('testResult', totalScore);
                window.location.href = 'resultados.html';
            } else {
                showQuestion(questions[currentQuestionIndex].pregunta);
                updateProgress(); // Actualiza la barra de progreso
            }
        }

        // ğŸ§ FunciÃ³n para el modo relajaciÃ³n
        function toggleRelaxationMode() {
            const audio = document.getElementById('relaxation-audio');
            const button = document.getElementById('relaxation-button');
            if (audio.paused) {
                audio.play();
                button.innerHTML = 'â¸ï¸'; // Cambia a Ã­cono de pausa
            } else {
                audio.pause();
                button.innerHTML = 'ğŸµ'; // Vuelve al Ã­cono de mÃºsica
            }
        }

        // InicializaciÃ³n del test
        async function init() {
            obtenerNombre();
            await cargarPreguntas();
            if (questions.length > 0) {
                showQuestion(questions[currentQuestionIndex].pregunta);
                updateProgress();
            }
        }

        // Ejecutar al cargar la pÃ¡gina
        window.onload = init;
    </script>
</head>

<body>
    <div class="bubbles-container">
        <div class="bubble"></div>
        <div class="bubble"></div>
        <div class="bubble"></div>
        <div class="bubble"></div>
        <div class="bubble"></div>
        <div class="bubble"></div>
        <div class="bubble"></div>
        <div class="bubble"></div>
        <div class="bubble"></div>
        <div class="bubble"></div>
    </div>

    <a href="index.html" class="back-button" title="Volver al Inicio">â†</a>

    <button id="relaxation-button" onclick="toggleRelaxationMode()" title="Modo RelajaciÃ³n">ğŸµ</button>
    <audio id="relaxation-audio" src="audio.mp3" loop></audio>

    <h1 id="nombreUsuario"></h1>

    <div class="main-container">
        <div id="progress-container">
            <div id="progress-text"></div>
            <div id="progress-flowers"></div>
        </div>

        <div id="question-container">
            <div class="question-box">
                <p id="question-text"></p>
            </div>
            <form id="quiz-form" onsubmit="event.preventDefault(); nextQuestion();">
                <div class="scale-container">
                    <label><input type="radio" name="answer" value="1"> Nunca ğŸ˜Œ</label>
                    <label><input type="radio" name="answer" value="2"> Casi nunca ğŸ™‚</label>
                    <label><input type="radio" name="answer" value="3"> A veces ğŸ˜</label>
                    <label><input type="radio" name="answer" value="4"> Casi siempre ğŸ˜Ÿ</label>
                    <label><input type="radio" name="answer" value="5"> Siempre ğŸ˜£</label>
                </div>
                <button type="submit">Siguiente</button>
            </form>
        </div>
    </div>
    <footer>
        <h3>ğŸ” Fuentes de este test</h3>
        <p>Basado en escalas cientÃ­ficas adaptadas para adolescentes:</p>

        <li>Espinosa, V. et al. (2022). Escala EIDAN â€“ Revista Iberoamericana de DiagnÃ³stico y EvaluaciÃ³n.</li>
        <li>GarcÃ­a-PÃ©rez, A. & Magaz, M. (1998). Escala EPANS â€“ Papeles del PsicÃ³logo.</li>
        <li>Olivares, J. et al. (2004). Escala EDAS â€“ PsicologÃ­a Conductual.</li>

        <p><em>Este test no reemplaza una consulta con profesionales. Si algo te preocupa, Â¡pide ayuda! ğŸ“–</em></p>
    </footer>

    <div id="instruction-modal" class="modal">
        <div class="modal-content">
            <h2>ğŸ“ Instrucciones antes de comenzar</h2>
            <p>
                Lee con atenciÃ³n cada pregunta.<br>
                Selecciona la opciÃ³n que mejor refleje cÃ³mo te has sentido <strong>Ãºltimamente</strong>.<br>
                Responde con sinceridad, no hay respuestas correctas o incorrectas.<br>
                El test es <strong>anÃ³nimo</strong> y no guarda informaciÃ³n personal.<br>
                Puedes activar el <strong>modo relajaciÃ³n ğŸµ</strong> si deseas hacerlo en un ambiente tranquilo.
            </p>
            <p>Cuando estÃ©s listo, comienza con la primera pregunta. Â¡TÃ³mate tu tiempo!</p>
            <button onclick="cerrarModal()">Comenzar</button>
        </div>
    </div>


</body>

</html>
